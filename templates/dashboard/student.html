{% extends 'base.html' %}
{% block title %}AMU C-FiX Portal - Dashboard{% endblock %}
{% block content %}
<script src="https://cdn.tailwindcss.com"></script>
<style>
    body {
        box-sizing: border-box;
    }
    .sidebar-transition {
        transition: all 0.3s ease-in-out;
    }
    .card-hover {
        transition: all 0.2s ease;
    }
    .card-hover:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }
    .status-pending { background: #fef3c7; color: #92400e; }
    .status-resolved { background: #d1fae5; color: #065f46; }
    .status-rejected { background: #fee2e2; color: #991b1b; }
    .status-in-progress { background: #dbeafe; color: #1e40af; }
    .fade-in {
        animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .amu-green { background-color: #2d5016; }
    .amu-beige { background-color: #f5f1e8; }
</style>
<div class="bg-gray-50 min-h-screen">
    <!-- Top Header -->
    <header class="amu-green text-white shadow-lg fixed w-full top-0 z-50">
        <div class="flex items-center justify-between px-6 py-4">
            <div class="flex items-center space-x-4">
                <button id="sidebarToggle" class="lg:hidden text-white hover:bg-green-800 p-2 rounded">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center">
                        <svg class="w-6 h-6 text-green-800" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3zm6.82 6L12 12.72 5.18 9 12 5.28 18.82 9zM17 15.99l-5 2.73-5-2.73v-3.72L12 15l5-2.73v3.72z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">AMU C-FiX Portal</h1>
                        <p class="text-green-200 text-sm">Complaint & Application Management</p>
                    </div>
                </div>
            </div>

            <div class="flex items-center space-x-4">
                <div class="hidden md:block text-right">
                    <p class="font-medium" id="userName">{{ user.first_name }} {{ user.last_name }}</p>
                    <p class="text-green-200 text-sm" id="userRole">{{ user.role|title }}</p>
                </div>
                <div class="relative">
                    <button id="profileDropdown" class="w-10 h-10 bg-green-700 rounded-full flex items-center justify-center hover:bg-green-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </button>
                    <div id="dropdownMenu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2">
                        <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">Profile Settings</a>
                        <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">Change Password</a>
                        <hr class="my-2">
                        <a href="{% url 'logout' %}" class="block px-4 py-2 text-red-600 hover:bg-gray-100">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex pt-20">
        <!-- Sidebar -->
        <aside id="sidebar" class="amu-green text-white w-64 min-h-screen fixed lg:relative lg:translate-x-0 transform -translate-x-full sidebar-transition z-40">
            <nav class="p-6">
                <!-- Role Selector (Disabled for Students) -->
                <div class="mb-6">
                    <label class="block text-green-200 text-sm mb-2">Role (Fixed for Students)</label>
                    <select id="roleSelector" class="w-full p-2 rounded bg-green-800 text-white border border-green-600" disabled>
                        <option value="student" selected>Student</option>
                    </select>
                </div>

                <ul class="space-y-2" id="navigationMenu">
                    <!-- Navigation items will be populated by JavaScript -->
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 lg:ml-0 p-6">
            <div id="dashboardContent" class="fade-in">
                <!-- Content will be populated by JavaScript -->
            </div>
        </main>
    </div>

    <!-- Overlay for mobile sidebar -->
    <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden hidden"></div>

    <script>
        // Dashboard data and configurations
        const dashboardConfigs = {
            student: {
                name: 'Student Dashboard',
                navigation: [
                    { id: 'overview', icon: 'M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z', label: 'Overview' },
                    { id: 'submit-complaint', icon: 'M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z', label: 'Submit Complaint' },
                    { id: 'submit-application', icon: 'M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z', label: 'Submit Application' },
                    { id: 'my-complaints', icon: 'M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z', label: 'My Complaints' },
                    { id: 'my-applications', icon: 'M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2', label: 'My Applications' },
                    { id: 'status-tracker', icon: 'M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z', label: 'Status Tracker' }
                ]
            }
        };

        // Global data variables
        let complaintsData = [];
        let applicationsData = [];

        let currentRole = 'student';
        let currentView = 'overview';

        // Filter variables
        let complaintCategoryFilter = '';
        let complaintStatusFilter = '';
        let applicationCategoryFilter = '';
        let applicationStatusFilter = '';

        // Search variables
        let complaintSearchQuery = '';
        let applicationSearchQuery = '';

        // Initialize dashboard
        function initDashboard() {
            updateUserInfo();
            loadData();
            renderNavigation();
            renderContent();
        }

        // Load data from APIs
        async function loadData() {
            try {
                // Load complaints
                const complaintsResponse = await fetch('/accounts/complaints/my/', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    }
                });
                const complaintsResult = await complaintsResponse.json();
                if (complaintsResult.success) {
                    complaintsData = complaintsResult.complaints.map(complaint => ({
                        ...complaint,
                        category: complaint.category.toLowerCase().replace(' ', '-'),
                        hall: complaint.hall.toLowerCase().replace(' ', '-')
                    }));
                }

                // Load applications
                const applicationsResponse = await fetch('/accounts/applications/my/', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    }
                });
                const applicationsResult = await applicationsResponse.json();
                if (applicationsResult.success) {
                    applicationsData = applicationsResult.applications.map(application => ({
                        ...application,
                        category: application.category.toLowerCase().replace(' ', '-')
                    }));
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        // Get CSRF token
        function getCSRFToken() {
            const cookieValue = document.cookie
                .split('; ')
                .find(row => row.startsWith('csrftoken='))
                ?.split('=')[1];
            return cookieValue || '';
        }

        // Update user info in header (Already handled by Django template)
        function updateUserInfo() {
            // Django template handles this
        }

        // Render navigation menu
        function renderNavigation() {
            const config = dashboardConfigs[currentRole];
            const menu = document.getElementById('navigationMenu');

            menu.innerHTML = config.navigation.map(item => `
                <li>
                    <button onclick="switchView('${item.id}')" class="w-full flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-green-700 transition-colors ${currentView === item.id ? 'bg-green-700' : ''}">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${item.icon}"></path>
                        </svg>
                        <span>${item.label}</span>
                    </button>
                </li>
            `).join('');
        }

        // Switch view
        function switchView(viewId) {
            currentView = viewId;

            // Reset filters and search when switching to list views
            if (viewId === 'my-complaints') {
                complaintCategoryFilter = '';
                complaintStatusFilter = '';
                complaintSearchQuery = '';
                // Update display after reset
                setTimeout(() => {
                    const categoryDisplay = document.getElementById('complaintCategoryDisplay');
                    const statusDisplay = document.getElementById('complaintStatusDisplay');
                    const searchInput = document.getElementById('complaintSearchInput');
                    if (categoryDisplay) categoryDisplay.textContent = 'All Categories';
                    if (statusDisplay) statusDisplay.textContent = 'All Status';
                    if (searchInput) searchInput.value = '';
                }, 100);
            } else if (viewId === 'my-applications') {
                applicationCategoryFilter = '';
                applicationStatusFilter = '';
                applicationSearchQuery = '';
                // Update display after reset
                setTimeout(() => {
                    const categoryDisplay = document.getElementById('applicationCategoryDisplay');
                    const statusDisplay = document.getElementById('applicationStatusDisplay');
                    const searchInput = document.getElementById('applicationSearchInput');
                    if (categoryDisplay) categoryDisplay.textContent = 'All Categories';
                    if (statusDisplay) statusDisplay.textContent = 'All Status';
                    if (searchInput) searchInput.value = '';
                }, 100);
            }

            renderNavigation();
            renderContent();
        }

        // Render main content
        function renderContent() {
            const content = document.getElementById('dashboardContent');

            switch(currentView) {
                case 'overview':
                    content.innerHTML = renderOverview();
                    break;
                case 'submit-complaint':
                    content.innerHTML = renderSubmitComplaint();
                    break;
                case 'submit-application':
                    content.innerHTML = renderSubmitApplication();
                    break;
                case 'my-complaints':
                    content.innerHTML = renderComplaintsList();
                    break;
                case 'my-applications':
                    content.innerHTML = renderApplicationsList();
                    break;
                case 'status-tracker':
                    content.innerHTML = renderStatusTracker();
                    break;
                default:
                    content.innerHTML = renderOverview();
            }
        }

        // Render overview dashboard
        function renderOverview() {
            const config = dashboardConfigs[currentRole];
            return `
                <div class="fade-in">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Welcome to ${config.name}</h2>
                        <p class="text-gray-600">Manage your complaints and applications efficiently</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow-md p-6 card-hover">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 text-sm">Total Complaints</p>
                                    <p class="text-2xl font-bold text-gray-800" id="totalComplaints">${complaintsData.length}</p>
                                </div>
                                <div class="bg-red-100 p-3 rounded-full">
                                    <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-md p-6 card-hover">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 text-sm">Total Applications</p>
                                    <p class="text-2xl font-bold text-gray-800" id="totalApplications">${applicationsData.length}</p>
                                </div>
                                <div class="bg-blue-100 p-3 rounded-full">
                                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-md p-6 card-hover">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 text-sm">Pending</p>
                                    <p class="text-2xl font-bold text-yellow-600" id="pendingCount">${complaintsData.filter(c => c.status === 'pending').length + applicationsData.filter(a => a.status === 'pending').length}</p>
                                </div>
                                <div class="bg-yellow-100 p-3 rounded-full">
                                    <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-md p-6 card-hover">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 text-sm">Resolved</p>
                                    <p class="text-2xl font-bold text-green-600" id="resolvedCount">${complaintsData.filter(c => c.status === 'resolved').length + applicationsData.filter(a => a.status === 'approved').length}</p>
                                </div>
                                <div class="bg-green-100 p-3 rounded-full">
                                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Recent Complaints</h3>
                            <div class="space-y-3">
                                ${complaintsData.slice(0, 3).map(complaint => `
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">${complaint.title}</p>
                                            <p class="text-sm text-gray-500">${complaint.category} • ${complaint.date}</p>
                                        </div>
                                        <span class="px-3 py-1 rounded-full text-xs font-medium status-${complaint.status}">
                                            ${complaint.status.charAt(0).toUpperCase() + complaint.status.slice(1)}
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Recent Applications</h3>
                            <div class="space-y-3">
                                ${applicationsData.slice(0, 3).map(application => `
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">${application.title}</p>
                                            <p class="text-sm text-gray-500">${application.category} • ${application.date}</p>
                                        </div>
                                        <span class="px-3 py-1 rounded-full text-xs font-medium status-${application.status === 'approved' ? 'resolved' : application.status}">
                                            ${application.status.charAt(0).toUpperCase() + application.status.slice(1)}
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Render submit complaint form
        function renderSubmitComplaint() {
            return `
                <div class="fade-in">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Submit New Complaint</h2>
                        <p class="text-gray-600">Report issues and concerns for quick resolution</p>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-8">
                        <form id="complaintForm" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">Complaint Category</label>
                                    <select name="category" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required>
                                        <option value="">Select category</option>
                                        <option value="infrastructure">Infrastructure</option>
                                        <option value="food">Food Services</option>
                                        <option value="maintenance">Maintenance</option>
                                        <option value="security">Security</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">Hall/Hostel</label>
                                    <select name="hall" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required>
                                        <option value="">Select hall/hostel</option>
                                        <optgroup label="Boys Halls">
                                            <option value="aftab">Aftab Hall</option>
                                            <option value="ambedkar">Dr. B.R. Ambedkar Hall</option>
                                            <option value="hadi-hasan">Hadi Hasan Hall</option>
                                            <option value="mohsinul-mulk">Mohsinul Mulk Hall</option>
                                            <option value="mohd-habib">Mohd. Habib Hall</option>
                                            <option value="nadeem-tarin">Nadeem Tarin Hall</option>
                                            <option value="ross-masood">Ross Masood Hall</option>
                                            <option value="sir-shah-sulaiman">Sir Shah Sulaiman Hall</option>
                                            <option value="sir-syed-north">Sir Syed Hall (North)</option>
                                            <option value="sir-syed-south">Sir Syed Hall (South)</option>
                                            <option value="sir-ziauddin">Sir Ziauddin Hall</option>
                                            <option value="viqarul-mulk">Viqarul Mulk Hall</option>
                                        </optgroup>
                                        <optgroup label="Girls Halls">
                                            <option value="abdullah">Abdullah Hall</option>
                                            <option value="bibi-fatima">Bibi Fatima Hall</option>
                                            <option value="begum-sultan-jahan">Begum Sultan Jahan Hall</option>
                                            <option value="begum-azeezun-nisa">Begum Azeezun Nisa Hall</option>
                                            <option value="indira-gandhi">Indira Gandhi Hall</option>
                                            <option value="sarojini-naidu">Sarojini Naidu Hall</option>
                                        </optgroup>
                                        <optgroup label="Other">
                                            <option value="nrsc">Non-Resident Students' Centre (NRSC)</option>
                                        </optgroup>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Complaint Title</label>
                                <input type="text" name="title" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Brief title of your complaint" required>
                            </div>

                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Detailed Description</label>
                                <textarea rows="5" name="description" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Provide detailed information about your complaint" required></textarea>
                            </div>

                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Priority Level</label>
                                <select name="priority" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required>
                                    <option value="low">Low</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="high">High</option>
                                    <option value="urgent">Urgent</option>
                                </select>
                            </div>

                            <div class="flex justify-end space-x-4">
                                <button type="button" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">Cancel</button>
                                <button type="submit" class="px-6 py-3 amu-green text-white rounded-lg hover:bg-green-800 transition-colors">Submit Complaint</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        // Render submit application form
        function renderSubmitApplication() {
            return `
                <div class="fade-in">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Submit New Application</h2>
                        <p class="text-gray-600">Apply for various university services and requests</p>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-8">
                        <form id="applicationForm" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">Application Type</label>
                                    <select name="application_type" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required>
                                        <option value="">Select application type</option>
                                        <option value="room-change">Room Change Request</option>
                                        <option value="library-subscription">Library Subscription</option>
                                        <option value="exam-revaluation">Exam Re-evaluation</option>
                                        <option value="fee-concession">Fee Concession</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">Department</label>
                                    <select name="department" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required>
                                        <option value="">Select department</option>
                                        <option value="dsw">Dean of Student Welfare</option>
                                        <option value="library">Library</option>
                                        <option value="examination">Examination Controller</option>
                                        <option value="accounts">Accounts</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Application Title</label>
                                <input type="text" name="title" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Brief title of your application" required>
                            </div>

                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Detailed Description</label>
                                <textarea rows="5" name="description" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Provide detailed information about your application" required></textarea>



                            <div class="flex justify-end space-x-4">
                                <button type="button" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">Cancel</button>
                                <button type="submit" class="px-6 py-3 amu-green text-white rounded-lg hover:bg-green-800 transition-colors">Submit Application</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        // Render complaints list
        function renderComplaintsList() {
            const filteredComplaints = complaintsData.filter(complaint => {
                const matchesCategory = !complaintCategoryFilter || complaint.category === complaintCategoryFilter;
                const matchesStatus = !complaintStatusFilter || complaint.status === complaintStatusFilter;
                const matchesSearch = !complaintSearchQuery ||
                    complaint.title.toLowerCase().includes(complaintSearchQuery.toLowerCase()) ||
                    complaint.description.toLowerCase().includes(complaintSearchQuery.toLowerCase()) ||
                    complaint.category.toLowerCase().includes(complaintSearchQuery.toLowerCase()) ||
                    complaint.hall.toLowerCase().includes(complaintSearchQuery.toLowerCase());
                return matchesCategory && matchesStatus && matchesSearch;
            });

            return `
                <div class="fade-in">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">My Complaints</h2>
                        <p class="text-gray-600">View and manage your complaint records</p>
                    </div>

                    <div class="bg-white rounded-lg shadow-md overflow-hidden">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0">
                                <div class="flex space-x-4">
                                    <select id="complaintCategoryFilter" onchange="updateComplaintFilters()" class="p-2 border border-gray-300 rounded-lg">
                                        <option value="">All Categories</option>
                                        <option value="infrastructure">Infrastructure</option>
                                        <option value="food-services">Food Services</option>
                                        <option value="maintenance">Maintenance</option>
                                        <option value="security">Security</option>
                                        <option value="other">Other</option>
                                    </select>
                                    <select id="complaintStatusFilter" onchange="updateComplaintFilters()" class="p-2 border border-gray-300 rounded-lg">
                                        <option value="">All Status</option>
                                        <option value="pending">Pending</option>
                                        <option value="in-progress">In Progress</option>
                                        <option value="resolved">Resolved</option>
                                        <option value="rejected">Rejected</option>
                                    </select>
                                </div>
                                <div class="flex space-x-2">
                                    <input type="search" id="complaintSearchInput" placeholder="Search complaints..." class="p-2 border border-gray-300 rounded-lg" oninput="updateComplaintSearch()">
                                    <button id="complaintSearchButton" class="px-4 py-2 amu-green text-white rounded-lg hover:bg-green-800 transition-colors" onclick="updateComplaintSearch()">Search</button>
                                </div>
                            </div>
                            <div class="mt-3 text-sm text-gray-600">
                                <span>Active filters: Category - <span id="complaintCategoryDisplay" class="font-medium">All Categories</span>, Status - <span id="complaintStatusDisplay" class="font-medium">All Status</span></span>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="amu-beige">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hall</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${filteredComplaints.map(complaint => `
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${complaint.id}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${complaint.title}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${complaint.category}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${complaint.hall}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${complaint.date}</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-3 py-1 rounded-full text-xs font-medium status-${complaint.status}">
                                                    ${complaint.status.charAt(0).toUpperCase() + complaint.status.slice(1)}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <button onclick="viewComplaint('${complaint.id}')" class="text-green-600 hover:text-green-900 mr-3">View</button>
                                                <button onclick="deleteComplaint('${complaint.id}')" class="text-red-600 hover:text-red-900">Cancel</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        // Render applications list
        function renderApplicationsList() {
            const filteredApplications = applicationsData.filter(application => {
                const matchesCategory = !applicationCategoryFilter || application.category === applicationCategoryFilter;
                const matchesStatus = !applicationStatusFilter || application.status === applicationStatusFilter;
                const matchesSearch = !applicationSearchQuery ||
                    application.title.toLowerCase().includes(applicationSearchQuery.toLowerCase()) ||
                    application.description.toLowerCase().includes(applicationSearchQuery.toLowerCase()) ||
                    application.category.toLowerCase().includes(applicationSearchQuery.toLowerCase()) ||
                    application.department.toLowerCase().includes(applicationSearchQuery.toLowerCase());
                return matchesCategory && matchesStatus && matchesSearch;
            });

            return `
                <div class="fade-in">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">My Applications</h2>
                        <p class="text-gray-600">View and manage your application records</p>
                    </div>

                    <div class="bg-white rounded-lg shadow-md overflow-hidden">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0">
                                <div class="flex space-x-4">
                                    <select id="applicationCategoryFilter" onchange="updateApplicationFilters()" class="p-2 border border-gray-300 rounded-lg">
                                        <option value="">All Categories</option>
                                        <option value="room-change">Room Change</option>
                                        <option value="library-subscription">Library Subscription</option>
                                        <option value="exam-revaluation">Exam Re-evaluation</option>
                                        <option value="fee-concession">Fee Concession</option>
                                        <option value="other">Other</option>
                                    </select>
                                    <select id="applicationStatusFilter" onchange="updateApplicationFilters()" class="p-2 border border-gray-300 rounded-lg">
                                        <option value="">All Status</option>
                                        <option value="pending">Pending</option>
                                        <option value="approved">Approved</option>
                                        <option value="rejected">Rejected</option>
                                    </select>
                                </div>
                                <div class="flex space-x-2">
                                    <input type="search" id="applicationSearchInput" placeholder="Search applications..." class="p-2 border border-gray-300 rounded-lg" oninput="updateApplicationSearch()">
                                    <button id="applicationSearchButton" class="px-4 py-2 amu-green text-white rounded-lg hover:bg-green-800 transition-colors" onclick="updateApplicationSearch()">Search</button>
                                </div>
                            </div>
                            <div class="mt-3 text-sm text-gray-600">
                                <span>Active filters: Category - <span id="applicationCategoryDisplay" class="font-medium">All Categories</span>, Status - <span id="applicationStatusDisplay" class="font-medium">All Status</span></span>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="amu-beige">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${filteredApplications.map(application => `
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${application.id}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${application.title}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${application.category}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${application.date}</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-3 py-1 rounded-full text-xs font-medium status-${application.status === 'approved' ? 'resolved' : application.status}">
                                                    ${application.status.charAt(0).toUpperCase() + application.status.slice(1)}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <button onclick="viewApplication('${application.id}')" class="text-green-600 hover:text-green-900 mr-3">View</button>
                                                <button onclick="deleteApplication('${application.id}')" class="text-red-600 hover:text-red-900">Cancel</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        // Render status tracker
        function renderStatusTracker() {
            const allItems = [
                ...complaintsData.map(c => ({ ...c, type: 'complaint', hall: c.hall })),
                ...applicationsData.map(a => ({ ...a, type: 'application', department: a.department }))
            ].sort((a, b) => new Date(b.date) - new Date(a.date));

            return `
                <div class="fade-in">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Status Tracker</h2>
                        <p class="text-gray-600">Track the status of your complaints and applications</p>
                    </div>
                    <div class="bg-white rounded-lg shadow-md p-8">
                        ${allItems.length === 0 ? '<p class="text-gray-600">No complaints or applications found.</p>' : `
                            <div class="space-y-4">
                                ${allItems.map(item => `
                                    <div class="border border-gray-200 rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center space-x-2">
                                                <span class="px-2 py-1 bg-${item.type === 'complaint' ? 'red' : 'blue'}-100 text-${item.type === 'complaint' ? 'red' : 'blue'}-800 text-xs font-medium rounded">
                                                    ${item.type === 'complaint' ? 'Complaint' : 'Application'}
                                                </span>
                                                <span class="text-sm font-medium text-gray-900">${item.title}</span>
                                            </div>
                                            <span class="px-3 py-1 rounded-full text-xs font-medium status-${item.status === 'approved' ? 'resolved' : item.status}">
                                                ${item.status.charAt(0).toUpperCase() + item.status.slice(1)}
                                            </span>
                                        </div>
                                        <div class="text-sm text-gray-600 mb-2">
                                            ${item.category} • ${item.date}
                                            ${item.type === 'complaint' ? ` • ${item.hall}` : ` • ${item.department}`}
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-${item.status === 'resolved' || item.status === 'approved' ? 'green' : item.status === 'in-progress' ? 'yellow' : 'gray'}-500 h-2 rounded-full" style="width: ${getProgressWidth(item.status)}%"></div>
                                        </div>
                                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                                            <span>Submitted</span>
                                            <span>${getStatusText(item.status)}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        // Helper function for progress width
        function getProgressWidth(status) {
            switch(status) {
                case 'pending': return 25;
                case 'in-progress': return 50;
                case 'resolved':
                case 'approved': return 100;
                case 'rejected': return 100;
                default: return 0;
            }
        }

        // Helper function for status text
        function getStatusText(status) {
            switch(status) {
                case 'pending': return 'Under Review';
                case 'in-progress': return 'In Progress';
                case 'resolved':
                case 'approved': return 'Completed';
                case 'rejected': return 'Rejected';
                default: return 'Unknown';
            }
        }

        // Event listeners
        document.getElementById('sidebarToggle').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');

            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        });

        document.getElementById('sidebarOverlay').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');

            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
        });

        document.getElementById('profileDropdown').addEventListener('click', function() {
            document.getElementById('dropdownMenu').classList.toggle('hidden');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            const dropdown = document.getElementById('profileDropdown');
            const menu = document.getElementById('dropdownMenu');

            if (!dropdown.contains(e.target) && !menu.contains(e.target)) {
                menu.classList.add('hidden');
            }
        });

        // Form submissions with AJAX
        document.addEventListener('submit', async function(e) {
            if (e.target.id === 'complaintForm') {
                e.preventDefault();
                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData);

                try {
                    const response = await fetch('/accounts/complaints/submit/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCSRFToken()
                        },
                        body: JSON.stringify(data)
                    });
                    const result = await response.json();
                    if (result.success) {
                        showComplaintSuccessModal(); // Show success modal
                        loadData(); // Reload data
                    } else {
                        alert('Error: ' + JSON.stringify(result.errors));
                    }
                } catch (error) {
                    console.error('Error submitting complaint:', error);
                    alert('An error occurred while submitting your complaint.');
                }
            }

            if (e.target.id === 'applicationForm') {
                e.preventDefault();
                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData);

                try {
                    const response = await fetch('/accounts/applications/submit/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCSRFToken()
                        },
                        body: JSON.stringify(data)
                    });
                    const result = await response.json();
                    if (result.success) {
                        showApplicationSuccessModal(); // Show success modal
                        loadData(); // Reload data
                    } else {
                        alert('Error: ' + JSON.stringify(result.errors));
                    }
                } catch (error) {
                    console.error('Error submitting application:', error);
                    alert('An error occurred while submitting your application.');
                }
            }
        });

        // View complaint details
        async function viewComplaint(complaintId) {
            try {
                const response = await fetch(`/accounts/complaints/${complaintId}/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    }
                });
                const result = await response.json();
                if (result.success) {
                    showItemModal(result.complaint, 'complaint');
                } else {
                    alert('Failed to load complaint details: ' + result.message);
                }
            } catch (error) {
                console.error('Error loading complaint details:', error);
                alert('An error occurred while loading complaint details.');
            }
        }

        // View application details
        async function viewApplication(applicationId) {
            try {
                const response = await fetch(`/accounts/applications/${applicationId}/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    }
                });
                const result = await response.json();
                if (result.success) {
                    showItemModal(result.application, 'application');
                } else {
                    alert('Failed to load application details: ' + result.message);
                }
            } catch (error) {
                console.error('Error loading application details:', error);
                alert('An error occurred while loading application details.');
            }
        }

        // Show modal with item details
        function showItemModal(item, type) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50';
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-medium text-gray-900">${type === 'complaint' ? 'Complaint' : 'Application'} Details</h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="text-sm text-gray-500">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <h4 class="font-semibold text-gray-900 mb-2">${type === 'complaint' ? 'Complaint' : 'Application'} Information</h4>
                                    <p><strong>ID:</strong> ${item.id}</p>
                                    <p><strong>Title:</strong> ${item.title}</p>
                                    <p><strong>Description:</strong> ${item.description}</p>
                                    ${type === 'complaint' ? `
                                        <p><strong>Category:</strong> ${item.category}</p>
                                        <p><strong>Department:</strong> ${item.department}</p>
                                        <p><strong>Hall:</strong> ${item.hall}</p>
                                        <p><strong>Priority:</strong> ${item.priority}</p>
                                    ` : `
                                        <p><strong>Type:</strong> ${item.application_type}</p>
                                        <p><strong>Department:</strong> ${item.department}</p>
                                    `}
                                    <p><strong>Status:</strong> <span class="status-${item.status} px-2 py-1 rounded text-xs font-semibold">${item.status.toUpperCase()}</span></p>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-900 mb-2">Student Information</h4>
                                    <p><strong>Name:</strong> ${item.student_name}</p>
                                    <p><strong>College ID:</strong> ${item.student_id}</p>
                                    <p><strong>Date Submitted:</strong> ${item.date}</p>
                                    <p><strong>Last Updated:</strong> ${item.updated_at}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Delete complaint with custom modal
        async function deleteComplaint(complaintId) {
            showDeleteConfirmation('complaint', complaintId);
        }

        async function deleteApplication(applicationId) {
            showDeleteConfirmation('application', applicationId);
        }

        // Show custom delete confirmation modal
        function showDeleteConfirmation(type, itemId) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50';
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/3 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <div class="flex items-center mb-4">
                            <div class="flex-shrink-0 w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">Delete ${type === 'complaint' ? 'Complaint' : 'Application'}</h3>
                                <p class="text-sm text-gray-500 mt-1">This action cannot be undone. This will permanently delete your ${type}.</p>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-4 mt-6">
                            <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                                Cancel
                            </button>
                            <button onclick="confirmDelete('${type}', '${itemId}'); this.closest('.fixed').remove()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                                Delete ${type === 'complaint' ? 'Complaint' : 'Application'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Confirm delete action
        async function confirmDelete(type, itemId) {
            try {
                const endpoint = type === 'complaint' ? '/accounts/complaints/delete/' : '/accounts/applications/delete/';
                const dataKey = type === 'complaint' ? 'complaint_id' : 'application_id';

                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    },
                    body: JSON.stringify({ [dataKey]: itemId })
                });
                const result = await response.json();
                if (result.success) {
                    showSuccessMessage(result.message);
                    await loadData(); // Reload data
                    switchView(type === 'complaint' ? 'my-complaints' : 'my-applications'); // Refresh the view
                } else {
                    showErrorMessage('Error: ' + result.message);
                }
            } catch (error) {
                console.error(`Error deleting ${type}:`, error);
                showErrorMessage(`An error occurred while deleting your ${type}.`);
            }
        }

        // Show success message
        function showSuccessMessage(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 fade-in';
            toast.innerHTML = `
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    ${message}
                </div>
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Show error message
        function showErrorMessage(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 fade-in';
            toast.innerHTML = `
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    ${message}
                </div>
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Show success modal for complaint submission
        function showComplaintSuccessModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50';
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/3 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <div class="flex items-center mb-4">
                            <div class="flex-shrink-0 w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">Complaint Submitted Successfully!</h3>
                                <p class="text-sm text-gray-500 mt-1">Your complaint has been submitted and is now pending review. You will receive updates on its status.</p>
                            </div>
                        </div>
                        <div class="flex justify-end mt-6">
                            <button onclick="this.closest('.fixed').remove(); switchView('my-complaints');" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                View My Complaints
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Show success modal for application submission
        function showApplicationSuccessModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50';
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/3 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <div class="flex items-center mb-4">
                            <div class="flex-shrink-0 w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">Application Submitted Successfully!</h3>
                                <p class="text-sm text-gray-500 mt-1">Your application has been submitted and is now pending review. You will receive updates on its status.</p>
                            </div>
                        </div>
                        <div class="flex justify-end mt-6">
                            <button onclick="this.closest('.fixed').remove(); switchView('my-applications');" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                View My Applications
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Update complaint filters
        function updateComplaintFilters() {
            complaintCategoryFilter = document.getElementById('complaintCategoryFilter').value;
            complaintStatusFilter = document.getElementById('complaintStatusFilter').value;

            // Update display text
            const categoryDisplay = document.getElementById('complaintCategoryDisplay');
            const statusDisplay = document.getElementById('complaintStatusDisplay');

            if (categoryDisplay && statusDisplay) {
                categoryDisplay.textContent = complaintCategoryFilter ?
                    document.getElementById('complaintCategoryFilter').options[document.getElementById('complaintCategoryFilter').selectedIndex].text :
                    'All Categories';
                statusDisplay.textContent = complaintStatusFilter ?
                    document.getElementById('complaintStatusFilter').options[document.getElementById('complaintStatusFilter').selectedIndex].text :
                    'All Status';
            }

            renderContent(); // Re-render the current view
        }

        // Update complaint search
        function updateComplaintSearch(event) {
            if (event) event.preventDefault();
            complaintSearchQuery = document.getElementById('complaintSearchInput').value.trim();
            renderContent(); // Re-render the current view
        }

        // Update application filters
        function updateApplicationFilters() {
            applicationCategoryFilter = document.getElementById('applicationCategoryFilter').value;
            applicationStatusFilter = document.getElementById('applicationStatusFilter').value;

            // Update display text
            const categoryDisplay = document.getElementById('applicationCategoryDisplay');
            const statusDisplay = document.getElementById('applicationStatusDisplay');

            if (categoryDisplay && statusDisplay) {
                categoryDisplay.textContent = applicationCategoryFilter ?
                    document.getElementById('applicationCategoryFilter').options[document.getElementById('applicationCategoryFilter').selectedIndex].text :
                    'All Categories';
                statusDisplay.textContent = applicationStatusFilter ?
                    document.getElementById('applicationStatusFilter').options[document.getElementById('applicationStatusFilter').selectedIndex].text :
                    'All Status';
            }

            renderContent(); // Re-render the current view
        }

        // Update application search
        function updateApplicationSearch(event) {
            if (event) event.preventDefault();
            applicationSearchQuery = document.getElementById('applicationSearchInput').value.trim();
            renderContent(); // Re-render the current view
        }

        // Initialize dashboard on page load
        document.addEventListener('DOMContentLoaded', function() {
            initDashboard();

            // Add event listeners for search inputs
            const complaintSearchInput = document.getElementById('complaintSearchInput');
            const complaintSearchButton = document.getElementById('complaintSearchButton');
            const applicationSearchInput = document.getElementById('applicationSearchInput');
            const applicationSearchButton = document.getElementById('applicationSearchButton');

            if (complaintSearchInput && complaintSearchButton) {
                complaintSearchInput.addEventListener('input', (e) => updateComplaintSearch(e));
                complaintSearchButton.addEventListener('click', (e) => updateComplaintSearch(e));
            }

            if (applicationSearchInput && applicationSearchButton) {
                applicationSearchInput.addEventListener('input', (e) => updateApplicationSearch(e));
                applicationSearchButton.addEventListener('click', (e) => updateApplicationSearch(e));
            }
        });
    </script>
</div>
{% endblock %}
